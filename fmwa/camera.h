/*
 * camera.h
 *
 *  Created on: Jan 18, 2021
 *      Author: arthu
 */

#ifndef SRC_CAMERA_H_
#define SRC_CAMERA_H_

#include "sleep.h"
#include "xparameters.h"



#define IPSTOP			 XPAR_COMANDOSTOP_V1_0_0_BASEADDR
#define	IPVSYNC			(XPAR_COMANDOSTOP_V1_0_0_BASEADDR + 0x4)
#define	IPVDEBOUNCE		(XPAR_COMANDOSTOP_V1_0_0_BASEADDR + 0x4 + 0x4)
#define	IPCONFEND		(XPAR_COMANDOSTOP_V1_0_0_BASEADDR + 0x4 + 0x4 +0x4)
#define INIT_CONFIG      XPAR_AXI_BRAM_CTRL_0_S_AXI_BASEADDR



void config_cam() {
	Xil_Out32(IPSTOP, 0);
	Xil_Out32(IPVDEBOUNCE, 1);
	sleep(2);//IMPRECISAO DA CONFIGURA��O PELO ARM
	while (Xil_In32(IPCONFEND) != 1) {

		asm("nop");
		usleep(1);
	}

	Xil_Out32(IPVDEBOUNCE, 0);
	//sleep(0.3);
}


void pausar_imagem() {
	Xil_Out32(IPSTOP, 1);
	while (Xil_In32(IPVSYNC) != 1) {

		asm("nop");
		usleep(1);
	}
}


void write_config_cam(){

    u32 config_buffer[57]={0x1280,0x1280,0x1204,0x1100,0x0C00,0x3E00,0x8C03,0x0400,0x40F0,0x3a04,0x1438,0x4fb3,0x50b3,
    					   0x5100,0x523d,0x53a7,0x54e4,0x589e,0x3dc0,0x1100,0x1711,0x1861,0x32A4,0x1903,0x1A7b,0x030a,
    					   0x0e61,0x0f4b,0x1602,0x1e34,0x2102,0x2291,0x2907,0x330b,0x350b,0x371d,0x3871,0x392a,0x3c78,
    					   0x4d40,0x4e20,0x6900,0x6b4a,0x7410,0x8d4f,0x8e00,0x8f00,0x9000,0x9100,0x9600,0x9a00,0xb084,
    					   0xb10c,0xb20e,0xb382,0xb80a,0xffff};

    /*u32 config_buffer[57]={0x1280,0x1280,0x1204,0x1100,0x0C00,0x3E00,0x8C03,0x0400,0x40F0,0x3a04,0x1438,0x4fb3,0x50b3,
    					   0x5100,0x523d,0x53a7,0x54e4,0x589e,0x3dc0,0x1100,0x1711,0x1861,0x32A4,0x1903,0x1A7b,0x030a,
    					   0x0e61,0x0f4b,0x1602,0x1e37,0x2102,0x2291,0x2907,0x330b,0x350b,0x371d,0x3871,0x392a,0x3c78,
    					   0x4d40,0x4e20,0x6900,0x6b4a,0x7410,0x8d4f,0x8e00,0x8f00,0x9000,0x9100,0x9600,0x9a00,0xb084,
    					   0xb10c,0xb20e,0xb382,0xb80a,0xffff};
*/
    for(int i=0;i<57;i++){
    Xil_Out32(INIT_CONFIG+4*i,config_buffer[i]);
    }




}




#endif /* SRC_CAMERA_H_ */



